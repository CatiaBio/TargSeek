# 3D Structure Metadata TSV Format

This document describes the format of the TSV file generated by `extract_3d_structure_metadata.py`.

## File Location
- **Output Path**: `results/{analysis}_{paramset}/3d_structures_metadata_{group}.tsv`
- **Example**: `results/analysis_1_params_1/3d_structures_metadata_positive.tsv`

## TSV Columns

| Column | Description | Example Values |
|--------|-------------|----------------|
| `analysis` | Analysis identifier | `analysis_1` |
| `paramset` | Parameter set identifier | `params_1` |
| `group` | Gram classification group | `positive`, `negative` |
| `gene_name` | Gene name | `bamA`, `tolC`, `ompA` |
| `structure_id` | Structure identifier | `3EFC`, `1YC9`, `AF-P12345` |
| `structure_type` | Type of structure | `experimental_structure`, `computed_model` |
| `database` | Source database | `PDB`, `AlphaFold` |
| `organism` | Source organism | `Escherichia coli`, `Bacillus subtilis` |
| `protein_name` | Protein name/description | `Outer membrane protein assembly factor BamA` |
| `quality_score` | Quality metric value | `2.10 Å`, `0.85` |
| `quality_type` | Type of quality metric | `Resolution`, `Confidence` |
| `experimental_method` | Method used | `X-ray diffraction`, `AlphaFold prediction` |
| `resolution` | Resolution for experimental structures | `2.10`, `N/A` |
| `model_confidence` | Confidence for computed models | `0.85`, `N/A` |
| `deposit_date` | Structure deposit/creation date | `2010-05-15`, `2021-07-01` |
| `journal` | Publication journal | `Nature`, `Science`, `N/A` |
| `authors` | Structure authors | `Smith J, Doe A, Johnson B` |
| `uniprot_accession` | UniProt accession | `P0A940`, `N/A` |
| `model_version` | Model version (AlphaFold) | `v4`, `N/A` |
| `sequence_length` | Protein sequence length | `810`, `N/A` |

## Data Sorting

The TSV file is sorted by:
1. **Gene name** (alphabetical)
2. **Structure type** (experimental structures first, then computed models)
3. **Quality score** (lower resolution first for experimental, higher confidence first for computed)

## Quality Scores

### Experimental Structures (PDB)
- **Metric**: Resolution in Angstroms (Å)
- **Better Quality**: Lower values (e.g., 1.5 Å is better than 3.0 Å)
- **Format**: `"2.10 Å"`

### Computed Models (AlphaFold)
- **Metric**: Model confidence score
- **Better Quality**: Higher values (e.g., 0.9 is better than 0.6)
- **Range**: 0.0 to 1.0
- **Format**: `"0.85"`

## Example Data

```tsv
analysis	paramset	group	gene_name	structure_id	structure_type	database	organism	protein_name	quality_score	quality_type	experimental_method	resolution	model_confidence	deposit_date	journal	authors	uniprot_accession	model_version	sequence_length
analysis_1	params_1	positive	bamA	3EFC	experimental_structure	PDB	Escherichia coli	Outer membrane protein assembly factor BamA	2.10 Å	Resolution	X-ray diffraction	2.10	N/A	2010-05-15	Nature	Smith J, Doe A	P0A940	N/A	N/A
analysis_1	params_1	positive	bamA	1T16	experimental_structure	PDB	Neisseria gonorrhoeae	BamA protein	2.90 Å	Resolution	X-ray diffraction	2.90	N/A	2004-03-22	Science	Johnson B	Q5F8B7	N/A	N/A
analysis_1	params_1	positive	tolC	AF-P02930	computed_model	AlphaFold	Escherichia coli	Outer membrane protein TolC	0.92	Confidence	AlphaFold prediction	N/A	0.92	2021-07-01	N/A	Unknown	P02930	v4	471
```

## Summary Statistics

Along with the TSV file, a summary JSON file is also generated:
- **Location**: `results/{analysis}_{paramset}/3d_structures_summary_{group}.json`
- **Contents**: 
  - Total structure counts
  - Gene coverage statistics
  - Database breakdown
  - Resolution statistics for experimental structures
  - Generation metadata

## Usage Examples

### Load and analyze in Python:
```python
import pandas as pd

# Load the metadata
df = pd.read_csv('results/analysis_1_params_1/3d_structures_metadata_positive.tsv', sep='\t')

# Show genes with experimental structures
exp_genes = df[df['structure_type'] == 'experimental_structure']['gene_name'].unique()
print(f"Genes with experimental structures: {len(exp_genes)}")

# Show best resolution structures per gene
best_resolution = df[df['structure_type'] == 'experimental_structure'].groupby('gene_name')['resolution'].min()
print("Best resolution per gene:")
print(best_resolution.sort_values())
```

### Command line analysis:
```bash
# Count structures per gene
cut -f4 results/analysis_1_params_1/3d_structures_metadata_positive.tsv | sort | uniq -c

# Show only high-confidence AlphaFold models
awk -F'\t' '$6=="computed_model" && $11+0 > 0.8 {print $4, $5, $10}' results/analysis_1_params_1/3d_structures_metadata_positive.tsv
```

## Running the Script

### Via Snakemake:
```bash
# Generate metadata for all groups
snakemake -s Snakefile_download all_3d_metadata --cores 4

# Generate for specific target
snakemake -s Snakefile_download results/analysis_1_params_1/3d_structures_metadata_positive.tsv --cores 1
```

### Standalone:
```bash
python scripts/extract_3d_structure_metadata.py
```